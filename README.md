# Описание
ETL-процесс, запускаемый ежедневно, детектирующий мошеннические банковские транзакции. Реализован в качестве финального проекта для дисциплины Data Engineering

# Структура проекта
```
archive                   <- Папка для сохранения обработанных данных
configs
    ├── database
    │   └── bank.yaml     <- Конфигурация таблиц банковской БД
    │   └── dwh.yaml      <- Конфигурация таблиц и запросов хранилища данных
    ├── os
    │   └── files.yaml    <- Конфигурация для обработки входных файлов
data                      <- Папка для сохранения входных данных
py_scripts
    ├── database
    │   └── clients.py    <- Классы для взаимодействия с БД
    │   └── models.py     <- Модели данных имен таблиц
    ├── os
    │   └── read.py       <- Обработка входных данных
    │   └── utils.py      <- Вспомогательные функции для работы с файлами
.env_template             <- Шаблон .env файла
.gitignore                <- Файлы, игнорируемые Git
.pre-commit-config.yaml   <- Конфигурация pre-commit
main.cron                 <- Конфигурация запуска crontab
main.ddl                  <- SQL-запросы для создания схемы данных
main.py                   <- Точка входа запуска ETL-процесса
README.md                 <- Описание проекта
requirements.txt          <- Необходимые зависимости проекта
```
# Описание файлов
- `main.py` - точка входа для запуска ETL-процесса обнаружения мошеннических транзакций, вызывает необходимые функции в нужной последовательности из `py_scripts`.
- `main.ddl` - SQL запросы для создания схемы хранилища данных.
- `main.cron` - файл, который содержит конфигурацию для запуска ETL-процесса в формате crontab. Предполагается наличие папки с виртуальным окружением (venv).

# Описание модулей
## Модуль clients.py
Содержит реализацию классов для взаимодействия с базой данных, включая функциональность для обнаружения мошеннических транзакций.
### Основные классы и их функции
1. `Client` - базовый класс для всех клиентов базы данных, который устанавливает соединение и предоставляет общие методы для работы с таблицами.
2. `BankDBClient` - наследуется от `Client` и предназначен для взаимодействия с банковской базой данных (схема `info`). Он получает информацию о клиентах и их счетах.
3. `DWHClient` - наследуется от `Client` и используется для работы с хранилищем данных. Он включает методы для создания схемы базы данных, вставки данных в таблицы (staging, dimension, fact, meta). Запускает `main.ddl` скрипт для создания схемы базы данных. В нем описаны методы для определения мошеннических операций.

#### Методы обнаружения мошеннических транзакций
Класс `DWHClient` включает несколько методов, которые отвечают за выявление мошеннических транзакций:

- `report_frauds`: Основной метод, который вызывает другие функции для формирования отчета о мошенничестве.

- `report_blacklist_fraud`: Выполняет SQL-запрос для обнаружения транзакций клиентов, чьи паспорта находятся в черном списке или просрочены.

- `report_invalid_contract_fraud`: Выполняет SQL-запрос для обнаружения транзакций, осуществленных клиентами с недействительными договорами.

- `report_transactions_in_different_cities_fraud`: Выполняет SQL-запрос для выявления транзакций, происходящих в разных городах за короткое время (1 час).

- `report_amount_guessing_fraud`: Выполняет SQL-запрос, который обрабатывает случаи угадывания злоумышленниками доступных сумм на карте для снятия или оплаты.

## Модуль models.py
Описаны модели данных имен таблиц банковской базы данных и хранилища данных, используя pydantic-классы, для удобного обращения к ним при написании SQL-запросов. В модуле также описаны методы для загрузки конфигурации и моделей данных из YAML-файлов.

## Модуль read.py
Содержит функции для обработки и подготовки входных данных, загружая их из файлов в формате CSV и Excel, а также очищая и структурируя данные для отправки в стейджинговые таблицы хранилища данных.

## Модуль utils.py
Содержит вспомогательные функции для работы с файлами: чтение, перемещение, работа с путями.



